# TCP-sever-client

当客户端请求与服务器连接时，例如参加视频会议，服务器应提示用户输入用户名和密码，并对用户进行认证。有效的用户名和密码组合将被存储在一个名为credentials.txt的文件中，该文件将与服务器程序在同一目录下。任务页上提供了一个credentials.txt文件的例子。用户名和密码是区分大小写的。我们可能会使用一个不同的文件进行测试，所以不要在你的程序中硬编码这些信息。你可以假设每个用户名和密码都在一个单独的行中，并且在两者之间会有一个空白。如果证书是正确的，客户就被认为是登录了，并显示一个欢迎信息。你应该确保credentials.txt文件的写入权限是启用的（在服务器当前工作目录的终端上键入 "chmod +w credentials.txt"）。

在输入无效的凭证时，会提示用户重试。在连续几次尝试失败后，用户会被封锁10秒（数字是提供给服务器的一个整数命令行参数，数字的有效值应该在1到5之间），在这10秒内不能登录（即使是从另一个IP地址登录）。如果向服务器提供了一个无效的数字值（例如，一个浮点值，0或6），服务器会打印出一条消息，例如 "允许的连续失败尝试的无效数量：数字。参数number的有效值是1到5之间的整数"。

对于非CSE学生。在用户成功登录后，服务器应该在活动用户日志文件（userlog.txt，你应该确保userlog.txt的写入权限被启用）中记录用户登录事件的时间戳和用户名。活动用户的编号从1开始。

活动用户序列号；时间戳；用户名
1; 1 Jun 2022 21:30:04; Yoda
对于CSE学生。在用户成功登录后，客户端接下来应该发送它正在监听的UDP端口号给服务器。服务器应该在活动用户日志文件（userlog.txt）中记录用户登录事件的时间戳、用户名、客户端监听的IP地址和端口号。
活动用户序列号；时间戳；用户名；客户端IP地址；客户端UDP服务器端口号
1; 1 Jun 2022 21:30:04; Yoda; 129.64.1.11; 6666
为了简单起见，一个用户在任何时候都会登录一次，例如，不允许同时进行多次登录，我们不会测试这种情况。

3.3. 文本信息命令
登录成功后，客户端会向用户显示一条信息，告知他们所有可用的命令，并提示其选择一条命令。以下命令是可用的。BCM：向所有活动用户广播信息，即公共信息，ATU。显示活跃用户，SRS：单独的聊天室服务，用户可以为部分活跃用户建立一个单独的房间，并在单独的房间里发送消息，RDM：读取消息，OUT：注销，UPD：上传文件（仅针对CSE学生）。所有可用的命令都应该在成功登录后的第一时间显示给用户。随后的操作提示也应包括这一信息。
如果选择了一个无效的命令，应该向用户显示一个错误信息，并提示他们选择一个可用的操作。
在下文中，将详细解释每个命令的实现。每条命令的预期用法（即语法）也包括在内。注意，所有的命令都应该是大写的（BCM、RDM等）。所有的参数（如果有的话）都用一个空白隔开，并将是一个字的长度（除了可以包含空白的消息和具有固定格式的dd mm yyyy hh:mm:ss的时间戳，如1 Jun 2022 16:01:20）。你可以假设消息文本可以包含大写字母（A-Z）、小写字母（a-z）和数字（0-9）以及以下有限的特殊字符集（！@#$%. ?，）。如果用户没有遵循下面列出的任何操作的预期用法，即缺少（例如，在发布信息时没有指定信息的主体）或参数数量不正确（例如，包含的参数比要求的多或少），应显示错误信息以


用户，并提示他们选择一个可用的命令。第8节说明了客户端和服务器之间的互动示例。
非CSE学生有6条命令，CSE学生有7条命令，用户可以执行这些命令。每条命令的执行情况描述如下。

BCM: 广播信息
BCM消息
消息正文应作为参数包括在内。注意，消息中可能包含空白（例如，"Hi Wei, how are you"）。客户端应该向服务器发送命令（即BCM）、消息和用户名。在我们的测试中，我们将只使用短消息（几个字长）。服务器应该在消息日志文件（文件（messagelog.txt，你应该确保messagelog.txt的写入权限被启用）的末尾附加消息、用户名和一个时间戳的格式，同时附加消息的编号（消息从1开始编号）。
messageNumber; timestamp; username; message
1; 1 Jun 2022 21:39:04; yoda; do or do not, there is no try
在服务器成功接收到消息后，一个包含消息类型（即广播消息）、消息编号和时间戳的确认消息应该从服务器发送到客户端，并显示给用户。如果BCM命令后没有参数。客户端应显示一条错误信息，然后提示用户选择一个可用的命令。

ATU:下载活动用户
ATU
这个命令应该没有参数。服务器应该检查除了发送ATU命令的客户端外，是否还有其他活动用户。如果有的话，服务器应该把活动用户日志文件中的用户名和时间戳（以及他们的IP地址和端口号，仅CSE学生）发送给客户端（服务器应该排除向服务器发送ATU命令的客户端的信息）。客户端应该在终端上向用户显示所有收到的用户信息。如果没有其他活动用户存在，一个 "没有其他活动用户 "的通知信息应该被发送到客户端，并在提示中显示给用户。客户端接下来应该提示用户选择一个可用的命令。
SRS：分房服务
该功能由两个命令组成。SRB: 分开房间建设和SRM: 分开房间信息。请看下面关于SRB和SRM的细节。
SRB 用户名1 用户名2 ...
客户端需要实践SRB命令，要求服务器建立一个单独的聊天室。参数是当前客户端希望包含在独立聊天室中的用户名。如果在SRB命令后没有参数，客户端应该显示一个错误信息，然后用一个可用的命令提示用户。服务器应该检查所提供的用户名是否存在，服务器还应该检查相应的用户是否活跃。如果任何一个用户名不存在或者相应的用户是离线的，服务器不应该创建一个单独的房间并回复客户哪个用户名不存在，或者用户是离线的。如果所有的提供的用户名都存在，并且所有相应的用户都在线，服务器应该为他们创建一个单独的房间，并且服务器应该生成一个单独的房间ID，该ID应该用整数表示，例如1、2、3。服务器还需要创建一个相应的日志文件（如SR_ID_messagelog.txt）来记录独立聊天室中的信息。最后，服务器应该回复客户端，确认独立房间已经成功创建，例如："独立聊天室已经创建，房间ID：1，这个房间的用户：username1，username2 ..."。注意，如果已经为这组用户创建了一个单独的房间，无论该组中的哪个用户创建，服务器都不应该再创建一个单独的房间，而应该用 "已经为这些用户创建了一个单独的房间（ID：1）"的信息通知客户端。此外，一个用户不能为他/她自己建立一个单独的房间。

SRM roomID消息
单独的房间ID和消息正文应该包含在参数中。作为第一个参数的房间ID表示客户想要发送消息的独立房间（假设客户可能在多个独立的聊天室）。服务器应该首先检查提供房间ID的房间是否存在。如果该房间ID的房间不存在，服务器应该向客户回复 "该独立房间不存在 "的信息。服务器还需要检查客户（客户发送SRM命令）是否是独立房间的成员，如果客户不在这个独立房间，服务器应该回复客户 "你不在这个独立房间聊天"。如果一切正常，服务器应该在消息日志文件（文件（SR_ID_messageLog.txt，你应该确保SR_ID_messageLog.txt的写入权限被启用）的末尾附加消息、用户名和时间戳，格式为，连同消息的编号（每一个新创建的独立房间聊天的消息都从1开始编号）。
messageNumber; timestamp; username; message
1; 1 Jun 2022 21:39:04; Yoda; do or do not, there is no try
在服务器成功接收到消息后，一条包含消息类型（即独立房间消息）、消息编号和时间戳的确认消息应该从服务器发送到客户端并显示给用户。如果SRM命令后没有参数。客户端应该在提示用户选择一个可用的命令之前显示一个错误信息。

RDM: 读取消息
RDM messageType timeestamp
messagType，对要读取的消息进行分组。在服务器端，有广播信息和单独的房间信息。小写字母b和s分别用来表示广播信息和独立房间信息。读取信息的时间戳应作为一个参数包括在内。客户端应该向服务器发送命令（RDM）、消息类型（即b或s）以及时间戳。服务器应该检查消息日志文件中是否有任何新的消息（即消息的时间戳比RDM消息中指定的时间戳大/晚）。如果有，服务器应该把这些新消息发送给客户端。客户端应该在终端向用户显示所有收到的消息。注意，如果消息组被指定为 "s"，并且客户端在多个独立的房间，服务器应该检查所有独立房间的消息日志文件，并将这些独立房间的新消息发送到客户端。如果没有新的消息存在，一个 "没有新的消息 "的通知消息应该被发送到客户端并在提示中显示给用户。客户端接下来应该提示用户选择一个可用的命令。

退出。登出
OUT
这个命令不应该有任何参数。客户端应该关闭TCP连接，（仅UDP点对点，CSE学生）并退出，并在终端向用户显示一个告别信息。服务器应该更新其关于当前登录用户的状态信息和活动用户的日志文件。也就是说，根据来自客户端的消息（包括用户名信息），服务器应该删除该用户，这需要删除活动用户日志文件中包含该用户的行（该文件中的所有后续用户应该向上移动一行，他们的活动用户序列号应该适当地更新），确认信息应该被发送到客户端并在提示中显示给用户。注意，用户上传的任何信息都不能被删除。为了简单起见，我们将不测试用户忘记注销或注销不成功的情况。
